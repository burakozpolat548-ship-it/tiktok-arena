<!DOCTYPE html>
<html>
<head>
<title>Ã‡Ã¶l SavaÅŸ ArenasÄ±</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:linear-gradient(#e0b46a,#f4d48b);
  font-family:Arial;
  text-align:center;
}

h1{
  margin:10px;
}

#battlefield{
  position:relative;
  width:100%;
  height:80vh;
}

.castle{
  position:absolute;
  font-size:70px;
}

#redCastle{ left:5%; top:50%; transform:translateY(-50%); }
#blueCastle{ right:5%; top:30%; }
#greenCastle{ right:5%; bottom:30%; }

.soldier{
  position:absolute;
  font-size:25px;
  transition:0.05s linear;
}
</style>
</head>
<body>

<h1>ğŸœï¸ Ã‡Ã¶l Kale SavaÅŸÄ±</h1>

<div id="battlefield">
  <div id="redCastle" class="castle">ğŸ°</div>
  <div id="blueCastle" class="castle">ğŸ°</div>
  <div id="greenCastle" class="castle">ğŸ°</div>
</div>

<script>

let soldiers = []

function spawnSoldier(team){
  const s = document.createElement("div")
  s.className="soldier"
  s.innerText="âš”ï¸"

  const field = document.getElementById("battlefield")

  if(team=="red"){
    s.style.left="8%"
    s.style.top="50%"
    s.dataset.dx=1
  }

  if(team=="blue"){
    s.style.left="85%"
    s.style.top="30%"
    s.dataset.dx=-1
  }

  if(team=="green"){
    s.style.left="85%"
    s.style.top="70%"
    s.dataset.dx=-1
  }

  s.dataset.team=team

  field.appendChild(s)
  soldiers.push(s)
}

function moveSoldiers(){
  soldiers.forEach((s,i)=>{
    let x = parseFloat(s.style.left)
    x += parseFloat(s.dataset.dx)
    s.style.left = x + "%"

    if(x>100 || x<0){
      s.remove()
      soldiers.splice(i,1)
    }
  })

  checkCollision()
}

function checkCollision(){
  for(let i=0;i<soldiers.length;i++){
    for(let j=i+1;j<soldiers.length;j++){
      const a=soldiers[i]
      const b=soldiers[j]

      if(a.dataset.team!==b.dataset.team){
        const ax=a.getBoundingClientRect()
        const bx=b.getBoundingClientRect()

        if(Math.abs(ax.left-bx.left)<20){
          a.remove()
          b.remove()
          soldiers.splice(j,1)
          soldiers.splice(i,1)
          return
        }
      }
    }
  }
}

async function update(){
  const res=await fetch("/teams")
  const data=await res.json()

  if(data.red>0) spawnSoldier("red")
  if(data.blue>0) spawnSoldier("blue")
  if(data.green>0) spawnSoldier("green")
}

setInterval(update,2000)
setInterval(moveSoldiers,30)

</script>

</body>
</html>
